var gm = require('gm');

function move(files , destination){
	create(destination);
  	console.log(files);
	 $.each(files , function(i,v){
	            fs.rename(v , destination + "/" + path.basename(v) , function(){});
	 });
}

function getFiles(directory , fileFormat , callback){
	glob(directory+"/"+ fileFormat, undefined, function (er, files) {
       callback(files);
    });
}

function rotate(images){
	$.each(images , function(i,f){
		console.log("image::::" + f);
		gm(f)
		.rotate('green', -90)
		.autoOrient()
		.write(f, function (err) {
		  	console.log(err);
		});
	});
}

function copy(files , destination , callback){
	create(destination);
	var arr = [];
	$.each(files , function(i , file){
		var name = destination + "/" + path.basename(file);
		fs.createReadStream(file)
		.pipe(fs.createWriteStream(name)).on('finish', function () { 
			arr.push(name);
			if(arr.length == files.length) callback(arr);
		 });
		
	});

}

function create(dir){
    if (!fs.existsSync(dir)){
        fs.mkdirSync(dir);
  	}
}

module.exports = {
	move : move ,
	getFiles : getFiles,
	rotate : rotate,
	copy : copy
}